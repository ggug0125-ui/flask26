{% extends "layout.html" %}
{% block title %}회원관리 | LHJ System{% endblock %}

{% block head_extra %}
<style>
  /* ===== 회원관리 테이블 압축 + 정렬 ===== */
  .member-card{
    background:#fff;
    border:1px solid rgba(233,236,244,.9);
    border-radius:18px;
    padding:12px; /* ✅ 카드 안쪽 여백 줄임 */
    box-shadow:0 12px 24px rgba(16,24,40,.06);
    overflow:auto;
  }

  .member-table{
    width:100%;
    border-collapse:collapse;
    min-width:820px;
  }

  .member-table thead tr{
    text-align:left;
    border-bottom:1px solid rgba(233,236,244,.9);
  }

  .member-table th,
  .member-table td{
    padding:10px 12px; /* ✅ 셀 여백 줄임 */
    font-size:14px;
    vertical-align:middle;
  }

  .member-table tbody tr{
    border-bottom:1px solid rgba(233,236,244,.6);
    height:52px; /* ✅ 행 높이 줄임 */
  }

  /* ===== 정지(비활성) 회원 회색 처리 ===== */
  .member-table tbody tr.is-disabled{
    background: rgba(17,24,39,.03);
    color: rgba(17,24,39,.55);
  }
  .member-table tbody tr.is-disabled .role-badge{
    opacity:.7;
    filter: grayscale(1);
  }
  .member-table tbody tr.is-disabled td{
    opacity:.85;
  }

  /* ===== 변경 영역 한 줄 정렬 ===== */
  .action-cell{ min-width:240px; }

  .action-row{
    display:flex;
    align-items:center;
    gap:8px;
    flex-wrap:nowrap;
  }

  .inline-form{
    display:flex;
    align-items:center;
    gap:6px;
    margin:0;
  }

  .role-select{
    padding:6px 10px;
    border-radius:10px;
    border:1px solid rgba(233,236,244,.95);
    background:#f7f8fd;
    font-weight:800;
    min-width:92px;
  }

  /* layout.html의 nav-btn을 작은 사이즈로 */
  .btn-sm{
    padding:6px 10px !important;
    border-radius:10px !important;
    font-size:13px;
    box-shadow:none !important;
  }

  .btn-stop{
    background:#ef4444;
    color:white;
    border:0;
    padding:6px 10px;
    border-radius:10px;
    font-weight:900;
    cursor:pointer;
  }

  .btn-restore{
    background:#16a34a;
    color:white;
    border:0;
    padding:6px 10px;
    border-radius:10px;
    font-weight:900;
    cursor:pointer;
  }

  /* (선택) 비활성 행에서 버튼 톤다운 – 클릭은 가능 */
  .member-table tbody tr.is-disabled button,
  .member-table tbody tr.is-disabled select{
    opacity:.85;
  }
</style>
{% endblock %}

{% block content %}
<div style="padding:14px 0;">
  <h2 style="margin:0 0 12px; font-weight:900;">회원관리</h2>

  <div class="member-card">
    <table class="member-table">
      <thead>
      <tr>
        <th>ID</th>
        <th>UID</th>
        <th>이름</th>
        <th>권한</th>
        <th>활성</th>
        <th>가입일</th>
        <th>변경</th>
      </tr>
      </thead>

      <tbody>
      {% for m in members %}
      <tr class="{% if not m.active %}is-disabled{% endif %}">
        <td>{{ m.id }}</td>
        <td>{{ m.uid }}</td>
        <td>{{ m.name }}</td>

        <td>
          <span class="role-badge role-{{ m.role }}">{{ m.role }}</span>
        </td>

        <td>{{ 'Y' if m.active else 'N' }}</td>
        <td>{{ m.created_at.strftime('%Y-%m-%d') if m.created_at else '' }}</td>

        <td class="action-cell">
          <div class="action-row">

            <!-- 권한 변경 -->
            <form method="post" action="/admin/members/role" class="inline-form">
              <input type="hidden" name="member_id" value="{{ m.id }}">

              <select name="role" class="role-select">
                <option value="user" {% if m.role == 'user' %}selected{% endif %}>user</option>
                <option value="manager" {% if m.role == 'manager' %}selected{% endif %}>manager</option>
                <option value="admin" {% if m.role == 'admin' %}selected{% endif %}>admin</option>
              </select>

              <button type="submit" class="nav-btn btn-sm">변경</button>
            </form>

            <!-- 활성 / 정지 -->
            <form method="post" action="/admin/members/active" class="inline-form">
              <input type="hidden" name="member_id" value="{{ m.id }}">

              {% if m.active %}
                <input type="hidden" name="active" value="0">
                <button type="submit" class="btn-stop">정지</button>
              {% else %}
                <input type="hidden" name="active" value="1">
                <button type="submit" class="btn-restore">복구</button>
              {% endif %}
            </form>

          </div>
        </td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
